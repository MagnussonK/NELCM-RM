<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Childrens Museum - Unified Record Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" href="logo.png" type="image/png">
    <style>
        body { font-family: 'Inter', sans-serif; background: #f0f4f8; }
        .main-container { max-width: 1200px; margin: 0 auto; }
        .view-container { padding: 2rem; background: white; border-radius: 1rem; margin-top: 2rem; }
        .form-group { margin-bottom: 1.25rem; }
        .action-buttons { margin-top: 1.5rem; display: flex; gap: 1rem; }
        .action-button { padding: 0.6rem 1.6rem; border-radius: 0.4rem; font-weight: 600; }
        .btn-primary { background: #6366f1; color: white; }
        .btn-secondary { background: #e5e7eb; color: #222; }
        .btn-delete { background: #dc2626; color: white; }
        .hidden { display: none; }
        table { width: 100%; border-collapse: collapse; margin-top: 2rem; }
        th, td { padding: 0.5em 1em; border-bottom: 1px solid #ddd; text-align: left; }
        th { background: #f3f4f6; }
    </style>
</head>
<body>
    <div class="main-container">
        <h1 class="text-3xl font-extrabold text-center text-gray-900 mt-8 mb-4">
            Unified Record Manager
        </h1>
        <div style="text-align: right; margin-bottom: 1em;">
            <button id="showAddBtn" class="btn-primary action-button">Add Member</button>
        </div>

        <!-- Add Member Form -->
        <section id="addRecordView" class="view-container hidden">
            <h2 class="text-xl font-bold text-gray-800 mb-4">Add New Member</h2>
            <form id="addRecordForm">
                <div class="form-group">
                    <label for="addName">First Name:</label>
                    <input type="text" id="addName" required>
                </div>
                <div class="form-group">
                    <label for="addLastName">Last Name:</label>
                    <input type="text" id="addLastName" required>
                </div>
                <div class="form-group">
                    <label>Birthday:</label>
                    <div style="display: flex; gap: 8px;">
                        <input type="number" id="addBirthMonth" min="1" max="12" required placeholder="MM" style="width:3em;">
                        <span>/</span>
                        <input type="number" id="addBirthDay" min="1" max="31" required placeholder="DD" style="width:3em;">
                        <span>/</span>
                        <input type="number" id="addBirthYear" min="1900" max="2100" placeholder="YYYY" style="width:4em;">
                        <span style="font-size:0.9em; color:#888">(Year optional)</span>
                    </div>
                </div>
                <!-- Add more fields as needed -->
                <div class="action-buttons">
                    <button type="submit" class="action-button btn-primary">Add</button>
                    <button type="button" id="addRecordCancelBtn" class="action-button btn-secondary">Cancel</button>
                </div>
            </form>
        </section>
        <!-- Edit Member Form -->
        <section id="recordDetailsView" class="view-container hidden">
            <h2 class="text-xl font-bold text-gray-800 mb-4">Edit Member</h2>
            <form id="recordDetailForm">
                <div class="form-group">
                    <label for="recordDetailsName">First Name:</label>
                    <input type="text" id="recordDetailsName" required>
                </div>
                <div class="form-group">
                    <label for="recordDetailsLastName">Last Name:</label>
                    <input type="text" id="recordDetailsLastName" required>
                </div>
                <div class="form-group">
                    <label>Birthday:</label>
                    <div style="display: flex; gap: 8px;">
                        <input type="number" id="recordDetailsBirthMonth" min="1" max="12" required placeholder="MM" style="width:3em;">
                        <span>/</span>
                        <input type="number" id="recordDetailsBirthDay" min="1" max="31" required placeholder="DD" style="width:3em;">
                        <span>/</span>
                        <input type="number" id="recordDetailsBirthYear" min="1900" max="2100" placeholder="YYYY" style="width:4em;">
                        <span style="font-size:0.9em; color:#888">(Year optional)</span>
                    </div>
                </div>
                <div class="action-buttons">
                    <button type="submit" class="action-button btn-primary">Update</button>
                    <button type="button" id="recordDetailsDeleteRecordBtn" class="action-button btn-delete">Delete</button>
                    <button type="button" id="recordDetailsCloseBtn" class="action-button btn-secondary">Close</button>
                </div>
            </form>
        </section>

        <!-- Members Table -->
        <section id="recordsView" class="view-container">
            <table id="membersTable" class="min-w-full divide-y divide-gray-200">
                <thead>
                    <tr>
                        <th>First Name</th>
                        <th>Last Name</th>
                        <th>Birthday</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="membersTableBody"></tbody>
            </table>
        </section>
    </div>
    <script>
    // Show/hide UI sections
    function showView(viewId) {
        document.querySelectorAll('.view-container').forEach(view => view.classList.add('hidden'));
        document.getElementById(viewId).classList.remove('hidden');
    }

    // Format birthday display as MM/DD or MM/DD/YYYY
    function formatBirthday(member) {
        if (!member.birth_month_day) return '';
        let bday = member.birth_month_day.replace('-', '/');
        if (member.birth_year) bday += '/' + member.birth_year;
        return bday;
    }

    // Load and render members table
    async function loadMembers() {
        const tbody = document.getElementById('membersTableBody');
        tbody.innerHTML = '';
        let response = await fetch('/api/data');
        let members = await response.json();
        members.forEach(member => {
            let tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${member.name || ''}</td>
                <td>${member.last_name || ''}</td>
                <td>${formatBirthday(member)}</td>
                <td>
                    <button class="btn-secondary action-button" onclick="editMember('${member.member_id}')">Edit</button>
                    <button class="btn-delete action-button" onclick="deleteMember('${member.member_id}')">Delete</button>
                </td>
            `;
            tbody.appendChild(tr);
        });
    }

    // Show add form
    document.getElementById('showAddBtn').onclick = () => showView('addRecordView');
    document.getElementById('addRecordCancelBtn').onclick = () => showView('recordsView');

    // Add member submit
    document.getElementById('addRecordForm').addEventListener('submit', async function(event) {
        event.preventDefault();
        const name = document.getElementById('addName').value.trim();
        const lastName = document.getElementById('addLastName').value.trim();
        const birthMonth = document.getElementById('addBirthMonth').value.padStart(2, '0');
        const birthDay = document.getElementById('addBirthDay').value.padStart(2, '0');
        const birthYear = document.getElementById('addBirthYear').value;
        if (!birthMonth || !birthDay) {
            alert('Birth month and day are required.');
            return;
        }
        const recordData = {
            name, last_name: lastName,
            birth_month: birthMonth, birth_day: birthDay,
            birth_year: birthYear ? parseInt(birthYear) : null
        };
        await fetch('/api/add_record', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(recordData)
        });
        showView('recordsView');
        loadMembers();
    });

    // Edit logic
    let editingMemberId = null;
    window.editMember = async function(memberId) {
        editingMemberId = memberId;
        let response = await fetch('/api/data');
        let members = await response.json();
        let member = members.find(m => m.member_id === memberId);
        if (!member) return;
        document.getElementById('recordDetailsName').value = member.name || '';
        document.getElementById('recordDetailsLastName').value = member.last_name || '';
        if (member.birth_month_day) {
            const [mm, dd] = member.birth_month_day.split('-');
            document.getElementById('recordDetailsBirthMonth').value = mm;
            document.getElementById('recordDetailsBirthDay').value = dd;
        } else {
            document.getElementById('recordDetailsBirthMonth').value = '';
            document.getElementById('recordDetailsBirthDay').value = '';
        }
        document.getElementById('recordDetailsBirthYear').value = member.birth_year || '';
        showView('recordDetailsView');
    };
    document.getElementById('recordDetailsCloseBtn').onclick = () => showView('recordsView');

    // Edit member submit
    document.getElementById('recordDetailForm').addEventListener('submit', async function(event) {
        event.preventDefault();
        if (!editingMemberId) return;
        const name = document.getElementById('recordDetailsName').value.trim();
        const lastName = document.getElementById('recordDetailsLastName').value.trim();
        const birthMonth = document.getElementById('recordDetailsBirthMonth').value.padStart(2, '0');
        const birthDay = document.getElementById('recordDetailsBirthDay').value.padStart(2, '0');
        const birthYear = document.getElementById('recordDetailsBirthYear').value;
        const recordData = {
            name, last_name: lastName,
            birth_month: birthMonth, birth_day: birthDay,
            birth_year: birthYear ? parseInt(birthYear) : null
        };
        await fetch(`/api/update_record/${editingMemberId}`, {
            method: 'PUT',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(recordData)
        });
        showView('recordsView');
        loadMembers();
    });

    // Delete member
    window.deleteMember = async function(memberId) {
        if (!confirm("Are you sure you want to delete this member?")) return;
        await fetch(`/api/delete_record/${memberId}`, { method: 'DELETE' });
        loadMembers();
    };

    // Initial load
    showView('recordsView');
    loadMembers();
    </script>
</body>
</html>
